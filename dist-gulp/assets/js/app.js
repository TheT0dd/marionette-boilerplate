define(["marionette","common/behaviors","apps/config/spinner/options","apps/config/marionette/regions/header","apps/config/marionette/regions/sidebar","apps/config/marionette/regions/main","apps/config/marionette/regions/dialog","apps/config/marionette/regions/loading","apps/config/marionette/regions/overlay","apps/config/validator/validator"],function(e,n,o){var t=window.App=new e.Application,i={};i.EnableCORS=!0,i.landingTrigger={admin:"some:trigger",user:"some:other:trigger",guest:"splash:show"},i.unprotectedURL=/splash|login|register|^static/,i.FileSizeLimit=2097152,i.RootURL="";var r=e.Region.Header.extend({el:"#header-section"}),a=e.Region.Sidebar.extend({el:"#sidebar-section"}),s=e.Region.Main.extend({el:"#main-region"}),g=e.Region.Dialog.extend({el:"#dialog-region"}),u=e.Region.Loading.extend({el:"#loading-region"}),d=e.Region.Overlay.extend({el:"#overlay-region"}),l=e.LayoutView.extend({el:"body",regions:{header:r,sidebar:a,main:s,dialog:g,loading:u,overlay:d}});return t.rootView=new l,e.Behaviors.behaviorsLookup=function(){return n},t.isLoggedIn=!1,t.requestedGuestUrl=!1,t.navigate=function(e,n){var o=n||{};Backbone.history.navigate(e,o)},t.getCurrentRoute=function(){return Backbone.history.fragment},t.executeAction=function(e,n,o){var o="undefined"!=typeof o?o:{};return o.asModal||t.execute("deselect:all:sidebar"),t.startSubApp(e,o.asModal),n(o)},t.startSubApp=function(e,n,o){var i=e?t.module(e):null;return n?(t.dialogApp=i,void i.start(o)):(t.rootView.getRegion("dialog").closeModal(),void(t.currentApp!==i&&(t.currentApp&&t.currentApp.stop(),t.currentApp=i,i&&i.start(o))))},t.showLanding=function(e){var n=e?e.get("role"):"guest",o=t.request("setting","landingTrigger")[n];t.trigger(o)},t.goBack=function(){window.history.back()},t.encode=function(e){return encodeURIComponent(encodeURIComponent(e))},t.decode=function(e){return decodeURIComponent(decodeURIComponent(e))},t.openInNewTab=function(e){var n=window.open(e,"_blank");n.focus()},t.goToUrl=function(e){window.location.href=e},t.openPopup=function(e){var n="left=10,top=10,resizable=yes,scrollbars=no,status=0,toolbar=0,width=920,height=436";return window.open(e,"App Popup",n)},t.initForMember=function(e){t.trigger("login",e,!1),Backbone.history.start(),""===t.getCurrentRoute()&&t.showLanding(e)},t.initForGuest=function(){console.log("initForGuest"),Backbone.history.start({silent:!0}),i.unprotectedURL.test(t.getCurrentRoute())?(Backbone.history.stop(),Backbone.history.start({silent:!1}),""===t.getCurrentRoute()&&t.showLanding()):(t.requestedGuestUrl=t.getCurrentRoute(),t.showLanding())},t.commands.setHandler("refresh:mainRegion",function(){var e=t.getCurrentRoute();Backbone.history.fragment=null,t.navigate(e,{trigger:!0}),console.log("App:refresh:mainRegion")}),t.on("login",function(e,n){console.info("User logged in. Role: ",e.get("role")),t.isLoggedIn=!0,n&&t.execute("refresh:mainRegion")}),t.on("logout",function(){t.isLoggedIn=!1,t.trigger("splash:show")}),t.reqres.setHandler("setting",function(e){return i[e]}),t});