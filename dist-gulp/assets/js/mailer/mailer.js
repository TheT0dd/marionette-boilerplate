define(["app","tpl!mailer/templates/_global","tpl!mailer/templates/sample.email"],function(e,t,n){return e.module("MailerApp",function(e,n,l,r,a,i){var s=n.request("setting","RootURL"),u=s+"/sendMessage",o={_addEmailTheme:function(e){return t({emailBody:e})},_preformat:function(e){return"<pre>"+e+"</pre>"},_addDetails:function(e,t,n){return"Message sent from "+(t.getFullName?t.getFullName():t)+" to "+(n.getFullName?n.getFullName():n)+":\n\n"+e},sendMail:function(e,t,n,r){var i=e instanceof l.Model?e:null,s=t instanceof l.Model?t:null;e=i?e.get("user").id:e,t=s?t.get("user").id:t;var m={};return m.to_id=t,m.subject="[App] "+(r||"no subject"),m.html=o._addEmailTheme(o._preformat(n)),"server"!==e&&(m.from_id=e),a.post(u,m)}};n.reqres.setHandler("mail:send",function(e,t,n,l){return o.sendMail(e,t,n,l)})}),e.MailerApp});